(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[203],{3874:function(e,r,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/game",function(){return t(3206)}])},921:function(e,r,t){"use strict";t.r(r);var n=t(5893);t(7294),r.default=function(e){let{color:r,filled:t,border:c,land_block:l,small:o,not_mine:i}=e,a="block  ".concat(!o&&c?"border":""," ").concat(t?"filled ":""," ").concat(l?"land_block":"","  ").concat(o||i?"small":"","  ").concat(t?r:""," ").concat(i?"not_mine_block":"");return(0,n.jsx)("div",{className:a})}},9650:function(e,r,t){"use strict";t.r(r);var n=t(5893),c=t(921),l=t(104);r.default=function(e){let{matrix:r,land_index:t,id:o}=e,i=(0,l.UC)(r,null==o?void 0:o.current).map(e=>[e[1]+t,e[0]]);return(0,n.jsx)("div",{children:null==r?void 0:r.map((e,r)=>(0,n.jsx)("div",{children:null==e?void 0:e.map((e,t)=>(0,n.jsx)(c.default,{color:0==e?"":e.color,filled:0!=e,border:3==r,land_block:i.filter(e=>e[0]==r&&e[1]==t).length},"".concat(r," ").concat(t)))},r))})}},6514:function(e,r,t){"use strict";t.r(r);var n=t(5893);t(7294);var c=t(921);r.default=function(e){let{next_block:r,current_block:t}=e;return(0,n.jsxs)("div",{className:"scoreboard_container ",children:[(0,n.jsx)("div",{className:"score_label",children:" Next "}),(0,n.jsx)("div",{className:"next_block_container",children:t&&(null==r?void 0:r.map((e,r)=>(0,n.jsx)("div",{className:"small_block_div",children:null==e?void 0:e.map((e,t)=>(0,n.jsx)(c.default,{color:0!=e&&e.color,filled:0!=e,border:3==r,small:1},"".concat(r," ").concat(t," ")))},r)))})]})}},5156:function(e,r,t){"use strict";t.r(r);var n=t(5893);t(7294),r.default=function(e){let{score:r}=e;return(0,n.jsxs)("div",{className:"scoreboard_container",children:[(0,n.jsx)("div",{className:"score_label",children:"Score"}),(0,n.jsx)("div",{className:"score",children:r})]})}},1036:function(e,r,t){"use strict";t.r(r);var n=t(5893),c=t(921);r.default=function(e){let{matrix:r}=e;return(0,n.jsx)("div",{children:null==r?void 0:r.map((e,r)=>(0,n.jsx)("div",{className:"small_row",children:null==e?void 0:e.map((e,t)=>(0,n.jsx)(c.default,{color:0==e?"":e.color,filled:0!=e,border:3==r,not_mine:1},"".concat(r," ").concat(t)))},r))})}},3206:function(e,r,t){"use strict";t.r(r);var n=t(5893),c=t(7294),l=t(104),o=t(9650),i=t(5156),a=t(6514),s=t(1036);function u(e){let{scores:r,bricks:t,username:u}=e,d=(0,c.useMemo)(()=>(0,l.cF)(),[]),[f,h]=(0,c.useState)(d),m=(0,c.useRef)(1),v=(0,c.useRef)(f),p=(0,c.useRef)(1),x=(0,c.useRef)(0),_=(0,c.useMemo)(()=>t?(0,l.K9)(x.current,JSON.parse(t)):(0,l.K9)(x.current),[]),N=(0,c.useRef)(0),[g,b]=(0,c.useState)(),[j,w]=(0,c.useState)(_),S=(0,c.useRef)(j),[k,O]=(0,c.useState)(0),J=(0,c.useRef)(k),[y,I]=(0,c.useState)((0,l.IG)(f,x.current));(0,c.useEffect)(()=>{v.current=f,I((0,l.IG)(f,x.current))},[f]);let M=()=>{try{let e=(0,l.Bo)(g),r={};for(let t in g)for(let n in g[t])for(let c in g[t][n],e)for(let o in e[c])0!=e[c][o]&&e[c][o].indices=="".concat(t).concat(n)&&(r["".concat(t).concat(n)]=[c-t,o-n]);var i,a=1;let s=JSON.parse(JSON.stringify(v.current)),u=[];for(let d of(0,l.UC)(v.current,x.current)){let m=(0,l.JG)(f[d[1]][d[0]]),p=r["".concat(m.indices[0]).concat(m.indices[1])];if(m.indices="".concat(parseInt(m.indices[0])+p[0]).concat([parseInt(m.indices[1])+p[1]]),void 0!=s[d[1]+p[0]][d[0]+p[1]]&&(0==s[d[1]+p[0]][d[0]+p[1]]||s[d[1]+p[0]][d[0]+p[1]].id==x.current))s[d[1]+p[0]][d[0]+p[1]]=m;else{a=0;break}u.push([d[1]+p[0],d[0]+p[1]])}if(a){for(let _ in s)for(let N in s[_])u.filter(e=>e[0]==_&&e[1]==N).length||(null===(i=s[_][N])||void 0===i?void 0:i.id)!=x.current||(s[_][N]=0);for(let j in e)for(let w in e[j])0!=e[j][w]&&(e[j][w].indices="".concat(j).concat(w));b(e),h(s),v.current=s}}catch(S){console.log("Rotate Error")}},E=()=>{let e=JSON.parse(sessionStorage.getItem("scores"));console.log(e);let r=J.current;if(e&&u&&!t){var n;let c=e.findIndex(e=>e.name==u);-1!=c?(e[c].score=Math.max(e[c].score,r),e[c].ts=Math.floor(Date.now()/1e3),e[c].matrix=v.current,e[c].latest_score=J.current,console.log(n=[...e])):n=[...e,{name:u,score:r,ts:Math.floor(Date.now()/1e3),matrix:v.current,latest_score:J.current}];let l={method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)};fetch("https://jsonblob.com/api/jsonBlob/1050371443183075328",l).then(e=>{N.current=1,console.log(e)}).catch(e=>console.log("error",e))}},T=()=>{var e;let r=JSON.parse(JSON.stringify(v.current));e=t?(0,l.K9)(x.current+1,JSON.parse(t)):JSON.parse(JSON.stringify((0,l.K9)(x.current+1)));let n=Math.floor(8*Math.random());for(let c=0;c<=3;c++)for(let o=n;o<=n+3;o++)r[c][o]=S.current[c][o-n];h(r),v.current=r,p.current=0,b(S.current),w(e),S.current=e},G=()=>{let e=JSON.parse(JSON.stringify(v.current));var r=1;if(!(0,l.T5)(v.current,x.current).down)for(let t=e.length-1;t>=0;t--)for(let n=e[t].length-1;n>=0;n--)e[t][n].id==x.current&&e[t+1]&&0==e[t+1][n]&&(e[t+1][n]=e[t][n],e[t][n]=0,r=0);p.current=r,x.current=x.current+(r?1:0),h(e),v.current=e},R=()=>{let e=(0,l.JG)(v.current),r=(0,l.e9)(v.current,x.current);for(let t of r){for(let n in e[t])e[t][n]=0;for(let c=t-1;c>=0;c--)e[c+1]=e[c]}h(e),v.current=e,O(J.current+12*r.length),J.current=J.current+12*r.length},C=()=>{if(E(),v.current[3].filter(e=>0!=e&&e.id!=x.current).length>0){window.alert("Game Over! Score : "+J.current),m.current=0;return}p.current?T():G(),R()},U=(e,r)=>{let t=x.current,n=JSON.parse(JSON.stringify(f));if(0==e&&r>0)for((0,l.IG)(v.current,x.current);r>0;){if(!(0,l.T5)(n,t).down)for(let c of(0,l.UC)(n,t)){let o=c[0],i=c[1];n[i+1][o]=n[i][o],n[i][o]=0}r--}else for(let a=n.length-1;a>=0;a--)for(let s=e>0?n[a].length-1:0;e>0&&s>=0||e<0&&s<n[a].length||0!=r&&s<n[a].length;e>0?s--:s++)0!=n[a][s]&&n[a][s].id==t&&(n[a][s+e]=n[a][s],n[a][s]=0);h(n),v.current=n},K=e=>{let r=(0,l.Iq)(f,x.current);"p"==e.key&&(m.current=!m.current),m.current&&("ArrowRight"!=e.code||(0,l.T5)(f,x.current).right?"ArrowLeft"!=e.code||(0,l.T5)(f,x.current).left?"ArrowDown"!=e.code||(0,l.T5)(f,x.current).down?"ArrowUp"==e.code?M():"Space"==e.code&&U(0,(0,l.IG)(v.current,x.current)):U(0,1,r.down):U(-1,0):U(1,0))};return(0,c.useEffect)(()=>(document.body.addEventListener("keydown",K),()=>{document.body.removeEventListener("keydown",K)}),[K,g,M]),(0,c.useEffect)(()=>{let e=setInterval(()=>{m.current&&C()},700);return()=>clearInterval(e)},[]),(0,n.jsx)("div",{className:"game",children:(0,n.jsxs)("div",{className:"overlay",children:[(0,n.jsxs)("div",{className:"top",children:[(0,n.jsx)(i.default,{score:k}),(0,n.jsx)(a.default,{next_block:j,current_block:g})]}),(0,n.jsx)("div",{className:"small_matrices",children:null==r?void 0:r.filter(e=>e.name!=u&&Date.now()/1e3-e.ts<=20).map(e=>(0,n.jsxs)("div",{className:"small_matrix",children:[(0,n.jsxs)("div",{className:"small_matrix_top",children:[(0,n.jsx)("span",{className:"player_name",children:e.name}),(0,n.jsx)("span",{className:"player_score",children:e.latest_score})]}),(0,n.jsx)(s.default,{matrix:e.matrix})]}))}),(0,n.jsx)("div",{className:"matrix",children:(0,n.jsx)(o.default,{matrix:f,land_index:y,id:x})})]})})}u.getInitialProps=async e=>{let{query:r}=e,{bricks:t,username:n}=r;return{bricks:t,username:n}},r.default=u},104:function(e,r,t){"use strict";t.d(r,{UC:function(){return o},cF:function(){return c},JG:function(){return d},Iq:function(){return i},e9:function(){return a},IG:function(){return f},K9:function(){return l},Bo:function(){return u},T5:function(){return s}});var n=JSON.parse('{"i_block":[[1,0,0,0],[1,0,0,0],[1,0,0,0],[1,0,0,0]],"j_block":[[1,0,0,0],[1,1,1,0],[0,0,0,0],[0,0,0,0]],"l_block":[[0,0,0,0],[0,0,1,0],[1,1,1,0],[0,0,0,0]],"o_block":[[1,1,0,0],[1,1,0,0],[0,0,0,0],[0,0,0,0]],"s_block":[[0,0,0,0],[0,1,1,0],[1,1,0,0],[0,0,0,0]],"t_block":[[0,0,0,0],[0,1,0,0],[1,1,1,0],[0,0,0,0]],"z_block":[[0,0,0,0],[1,1,0,0],[0,1,1,0],[0,0,0,0]]}');let c=()=>{let e=[0,0,0,0,0,0,0,0,0,0,0,0],r=[];for(let t=0;t<20;t++)r[t]=[...e];return r},l=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n,t=["pink","orange","blue","green"],c=t[Math.floor(Math.random()*(t.length-1))],l=Object.keys(r),o=r[l[Math.floor(Math.random()*(l.length-1))]],i=[];for(let a in o){let s=o[a].map((r,t)=>0==r?0:{id:e,indices:"".concat(a).concat(t),color:c});i.push(s)}return i},o=(e,r)=>{let t=[];for(let n in e){let c=e[n];for(let l in c){let o=c[l];0!=o&&o.id==r&&t.push([parseInt(l),parseInt(n)])}}return t.reverse(),t},i=(e,r)=>{let t=o(e,r),n=t.map(e=>e[0]),c=t.map(e=>e[1]);return{left:Math.min(...n),right:Math.max(...n),down:Math.max(...c),up:Math.min(...c)}},a=(e,r)=>{let t=[];for(let n in e)0==e[n].filter(e=>0==e||e.id==r).length&&t.push(n);return t},s=(e,r)=>{let t=o(e,r),n={left:0,right:0,down:0};for(let c of t){let l=c[1],i=c[0];n.left=0==i||0!=e[l][i-1]&&e[l][i-1].id!=r||n.left,n.right=11==i||0!=e[l][i+1]&&e[l][i+1].id!=r||n.right,n.down=19==l||e[l+1][i]&&e[l+1][i].id!=r||n.down}return n},u=e=>{let r=JSON.parse(JSON.stringify(e)),t=[];for(let n in e){let c=e[n];for(let l in c)0!=e[n][l]&&(r[l][4-n]=e[n][l],t.push([l,4-n]))}for(let o in r)for(let i in r[o])t.filter(e=>e[0]==o&&e[1]==i).length||(r[o][i]=0);var a=3;for(let s of r)a=s.findIndex(e=>(null==e?void 0:e.id)>=0)>-1?Math.min(s.findIndex(e=>(null==e?void 0:e.id)>=0),a):a;for(let u in r)for(let d in r[u])d-a>=0&&(r[u][d-a]=r[u][d],r[u][d]=0);return r},d=e=>JSON.parse(JSON.stringify(e)),f=(e,r)=>{let t=i(e,r).down,n=o(e,r);var c=0;if(t!=-1/0)for(let l=t;l<19;l++){var a=1;for(let s of n){let u=e[s[1]+1][s[0]];if(0!=u&&u.id!=r)return a=0,c}if(0==a)break;for(let d of(c+=1,t+=1,n))d[1]+=1}return c}}},function(e){e.O(0,[774,888,179],function(){return e(e.s=3874)}),_N_E=e.O()}]);